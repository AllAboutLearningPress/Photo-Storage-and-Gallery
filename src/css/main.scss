@import 'customised-bootstrap';

$sidebar-width: 216px;
$sidebar-gap: 1.1rem;
$sidebar-left-pad: 1.3rem;

$main-x-pad: 1rem;
$main-y-pad: 2rem;

// Reuse `.form-control` focus styles from `bootstrap/scss/forms/_form-control.scss`
@mixin bootstrap-focus() {
  color: $input-focus-color;
  background-color: $input-focus-bg;
  border-color: $input-focus-border-color;
  outline: 0;

  @if $enable-shadows {
    @include box-shadow($input-box-shadow, $input-focus-box-shadow);
  } @else {
    // Avoid using mixin so we can pass custom focus shadow properly
    box-shadow: $input-focus-box-shadow;
  }
}

/*
    Basic
*/
html,
body {
  height: 100%;
}

/*
    Page wrapper
*/
.wrapper {
  min-height: 100%;
  overflow: hidden;
}

/*
  Header
*/
$header-height: 74px;

.header {
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  height: $header-height;
  z-index: 199;
  background: $page-bg;
  padding: 0.9rem $main-x-pad;
  border-bottom: 1px solid $contrast1;
  display: flex;
  flex-wrap: wrap;
}
.header__slot_logo,
.header__slot_actions {
  flex-grow: 0;
  white-space: nowrap;
}
.is-searchable .header__slot_logo,
.is-searchable .header__slot_actions {
  position: absolute;
  z-index: 0;
}
.header__slot_logo {
  padding-left: $sidebar-left-pad;
  margin-left: -$sidebar-left-pad;

  @include media-breakpoint-up(md) {
    width: calc(#{$sidebar-width} + #{$sidebar-gap} + #{$main-x-pad});
    flex: 0 0 auto;
  }
}
.header__slot_search {
  max-width: 720px;
  flex-grow: 1;

  @include media-breakpoint-up(sm) {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}
.header__slot_actions {
  margin-left: auto;
}

.header__action-btn__txt {
  display: none;

  @include media-breakpoint-up(lg) {
    display: inline;
  }
}

.header__open-sidebar {
  margin-top: -0.15em;
  margin-left: -$btn-close-padding-x;

  @include media-breakpoint-up(md) {
    display: none;
  }
}

/*
  Search
*/

.search {
  text-align: right;

  @include media-breakpoint-up(xs) {
    position: static;
  }
}

.search__field {
  display: none;
  text-align: left;
  position: relative;
  z-index: 2;

  @include media-breakpoint-up(sm) {
    display: block;
  }
}
.is-searchable .search__field {
  display: block;
}
.search__field-show {
  @include media-breakpoint-up(sm) {
    display: none;
  }
}
.search__field-show > svg.bi {
  position: relative;
  top: -0.15em;
}
.is-searchable .search__field-show {
  @include visually-hidden();
  @include visually-hidden-focusable();
}

.search__infield-action {
  position: absolute;
  top: 0;
  z-index: 10;
  padding-left: 0.5rem;
  padding-right: 0.5rem;
  border-color: transparent;
}
.search__infield-action_hide {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;

  @include media-breakpoint-up(sm) {
    display: none;
  }
}
.is-suggesting .search__infield-action_hide {
  border-bottom-left-radius: 0;
}

.search__infield-action > svg.bi {
  position: relative;
  top: -0.15em;
}

.search__infield-action_image-search {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  right: 0;
}

.search__input {
  padding-left: calc(3rem + 0.2em);
  padding-right: calc(3rem + 0.2em);

  @include media-breakpoint-up(sm) {
    padding-left: $input-padding-x-lg;
  }
}

// match specificity from `custom-bootstrap.scss`
.search__input:not([type=hidden]):not([type=radio]):not([disabled]):not([tabindex^="-"]),
.search__field-show.has-no-transition:not([disabled]):not([tabindex^="-"]) {
  @include media-breakpoint-down(sm) {
    transition: none;
  }
}
.is-suggesting .search__input {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-color: $input-focus-border-color;
}
.search__field:focus-within .search__input {
  @include bootstrap-focus();
}

.search-dumb-mq-tester {
  display: none;

  @include media-breakpoint-up(sm) {
    display: block;
  }
}
.search__suggest,
.search__suggest::after {
  position: absolute;
  left: 0;
  right: 0;
  border-bottom-left-radius: $input-border-radius-lg;
  border-bottom-right-radius: $input-border-radius-lg;
}
.search__suggest {
  display: none;
  list-style: none;
  margin: 0;
  padding: 0;
  top: 100%;
  background-color: $input-focus-bg;
}
.search__suggest-content {
  max-height: 200px;
  overflow-x: auto;
}
.is-suggesting .search__suggest {
  display: block;
}
.search__suggest::after {
  content: '';
  z-index: -1;
  bottom: 0;
  top: calc(2 * #{$input-btn-focus-width});
  transition: $input-transition;
}
.search__field:focus-within .search__suggest::after {
  box-shadow: $input-focus-box-shadow;
}

.search__suggest-item,
.search__suggest-item:hover,
.search__suggest-item:focus,
.search__suggest-item.is-highlighted {
  color: $page-text-color;
}
.search__suggest-item {
  border-color: $contrast1;
  padding-left: $input-padding-x-lg;
  padding-right: $input-padding-x-lg;
  background-color: transparent;
}

.search__suggest-item:hover,
.search__suggest-item:focus,
.search__suggest-item.is-highlighted {
  background-color: $contrast1;
}

.search__suggest-item:focus-visible {
  outline: 0;
  box-shadow: $input-btn-focus-box-shadow;
}

/*
  File input as a button
*/
.button-file:focus-within {
  box-shadow: $btn-focus-box-shadow;
}
.button-file__input {
  @include visually-hidden();
  @include visually-hidden-focusable();
}

/*
   Content
*/
.content {
  padding: calc(#{$header-height} + #{$main-y-pad}) $main-x-pad;
}

/*
    Sidebar
*/

$sidebar-animation-duration: 0.2s;

.sidebar {
  background: $contrast1;
  width: $sidebar-width;
  max-width: 100%;
  position: fixed;
  z-index: 201;
  left: 0;
  top: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  will-change: transform;
  transform: translateX(-100%);
  transition: visibility $sidebar-animation-duration, transform $sidebar-animation-duration;
  outline: none;
  box-shadow: 0 0.5rem 1rem rgba($black, 0.9);
  visibility: hidden;
}
.sidebar_right {
  left: auto;
  right: 0;
  transform: translateX(100%);
}
.sidebar:not(.sidebar_always-hideable) {
  @include media-breakpoint-up(md) {
    visibility: visible;
    transform: translateX(0);
    transition: none;
    top: calc(#{$header-height} + #{$main-y-pad});
    background: none;
    box-shadow: none;
  }
}
.sidebar.is-open {
  visibility: visible;
  transform: translateX(0);
}

.sidebar__head {
  padding: 1rem 0.5rem;
  text-align: right;

  @include media-breakpoint-up(md) {
    padding-top: 0;
    padding-bottom: 0;
  }
}

.sidebar__close {
  @include media-breakpoint-up(md) {
    display: none;
  }
}

.sidebar__body {
  flex-grow: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.sidebar-backdrop {
  position: fixed;
  z-index: 200;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  background: rgba(0, 0, 0, $modal-backdrop-opacity);
  pointer-events: none;
  opacity: 0;
  will-change: opacity;
  transition: opacity $sidebar-animation-duration;
}
.sidebar.is-open ~ .sidebar-backdrop {
  opacity: 1;
  pointer-events: auto;

  @include media-breakpoint-up(md) {
    display: none;
  }
}

.overlaying-sidebar-mq-test-elem {
  display: none;

  @include media-breakpoint-up(md) {
    display: block;
  }
}

/*
    Logo
*/
.logo {
  padding-left: 0.5rem;
  padding-right: 0.5rem;

  @include media-breakpoint-up(md) {
    padding-left: 1rem;
    padding-right: 1rem;
    margin-left: -1rem;
  }
}
/*
    Navigation
*/
.navigation__item,
.navigation__item:hover,
.navigation__item:focus {
  color: $page-text-color;
}

.navigation__item {
  background-color: transparent;
  border: none;
  padding: 0.5rem 2rem 0.5rem $sidebar-left-pad;
  font-size: 1.2rem;
}

.navigation__item:not(.active):hover,
.navigation__item:not(.active):focus {
  background-color: $page-bg;

  @include media-breakpoint-up(md) {
    background-color: $contrast1;
  }
}

.navigation__item:focus-visible {
  outline: 0;
  box-shadow: $input-btn-focus-box-shadow;
}

.navigation__item.active,
.navigation__item.active:hover,
.navigation__item.active:focus {
  color: #000;
}

/*
    Main page content
*/
.main {
  position: relative;
  margin-left: 0;

  @include media-breakpoint-up(md) {
    margin-left: calc(#{$sidebar-width} + #{$sidebar-gap});
  }
}

/*
    Menu button
*/
.btn-menu {
  box-sizing: content-box;
  width: $btn-close-width;
  height: $btn-close-height;
  padding: $btn-close-padding-y $btn-close-padding-x;
  color: $btn-close-color;
  background: transparent
    escape-svg(
      url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#{$btn-close-color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>')
    )
    50% 50% no-repeat; // include transparent for button elements
  border: 0; // for button elements
  @include border-radius();
  opacity: $btn-close-opacity;

  // Override <a>'s hover style
  &:hover,
  &:focus {
    color: $btn-close-color;
    text-decoration: none;
    opacity: $btn-close-hover-opacity;
  }

  &:focus-visible {
    outline: 0;
    box-shadow: $btn-close-focus-shadow;
    opacity: $btn-close-focus-opacity;
  }

  &:disabled,
  &.disabled {
    pointer-events: none;
    user-select: none;
    opacity: $btn-close-disabled-opacity;
  }
}

/*
  Improve touch hit area for standalone checkboxes/radios.
  For this `.form-check` element should be a `<label>`
*/
.form-check_standalone {
  position: relative;
  display: inline-block;
  padding: 0;
  min-height: 0;
  margin: 0;
  vertical-align: baseline;
}
.form-check_standalone::before {
  content: '';
  position: absolute;
  width: 44px;
  height: 44px;
  left: 50%;
  // .25em is default bootstrap margin-top for `.form-check-input` which allows vertical aligning with text
  top: calc(50% + (0.25em / 2));
  transform: translate(-50%, -50%);
}
.form-check_standalone > .form-check-input {
  margin-left: 0;
  margin-right: 0;
}

/*
  Gallery
*/

.pig-figure {
  background-color: $contrast1 !important;
}

/*
  Image view
*/

$image-view-sidebar-width: 400px;
$image-view-toolbar-height: 72px;
$image-view-toolbar-y-pad: .907rem;
$image-view-image-actions-bp: 450px;

.image-view {
  height: 100%;
  display: flex;
  position: relative;
  overflow: hidden;
}

.image-view__picture-area {
  position: absolute;
  z-index: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  transition: right $sidebar-animation-duration;
  will-change: right;
}
.image-view__details.is-open ~ .image-view__picture-area {
  @include media-breakpoint-up(md) {
    right: $image-view-sidebar-width;
  }
}

.image-view__toolbar {
  position: absolute;
  z-index: 2;
  left: 0;
  right: 0;
  display: flex;
  flex-grow: 0;
  height: $image-view-toolbar-height;
  padding: $image-view-toolbar-y-pad $main-x-pad;
  background-color: transparentize($page-bg, 0.5);
  white-space: nowrap;
}
.image-view__toolbar-main,
.image-view__toolbar-aside {
  flex-grow: 0;
}
.image-view__toolbar-main {
  margin-left: -$main-x-pad;

  @media (min-width: $image-view-image-actions-bp) {
    margin-left: 0;
  }
}
.image-view__toolbar-aside {
  display: flex;
  flex-wrap: nowrap;
  margin-left: auto;
  white-space: nowrap;

  margin-right: -$main-x-pad;

  @media (min-width: $image-view-image-actions-bp) {
    margin-right: 0;
  }
}

$image-view-toolbar-action-sections-gap: .5rem;

.image-view__image-actions {
  padding-right: $image-view-toolbar-action-sections-gap / 2.5;

  @media (min-width: $image-view-image-actions-bp) {
    padding-right: $image-view-toolbar-action-sections-gap;
  }
}
.image-view__main-actions {
  border-left: 1px solid $contrast2;
  padding-left: $image-view-toolbar-action-sections-gap / 2.5;

  @media (min-width: $image-view-image-actions-bp) {
    padding-left: $image-view-toolbar-action-sections-gap;
  }
}

.image-view__pic {
  z-index: 0;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  position: relative;
  height: 0;
  max-width: 100%;
}
.image-view__img,
.image-view__picture-nav {
  position: absolute;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -o-user-select: none;
  user-select: none;
}
.image-view__img {
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}

$image-view-picture-nav-size: 36px;
$image-view-picture-nav-color: $page-text-color;
$image-view-picture-nav-gap-y: 1rem;

.image-view__picture-nav {
  z-index: 1;
  top: 100px;
  bottom: 0;
  width: 50%;
  outline: none !important;
}
.image-view__picture-nav::before,
.image-view__picture-nav::after {
  content: '';
  position: absolute;
}
.image-view__picture-nav::before {
  z-index: 0;
  bottom: 0;
  left: 0;
  right: 0;
  padding: $image-view-toolbar-y-pad $main-x-pad;
  background-color: transparentize($page-bg, 0.5);
  height: calc(#{$image-view-picture-nav-size} + 15px * 2);
}
.image-view__picture-nav::after {
  z-index: 1;
  width: $image-view-picture-nav-size;
  height: $image-view-picture-nav-size;
  bottom: $image-view-picture-nav-gap-y;
  background-repeat: no-repeat;
  background-position: 0 0;
  background-size: cover;

  border-radius: $input-border-radius;
  transition: transform 0.15s;
  transform: translateY(0) scale(1);
  will-change: transform;
}
.image-view__picture-nav:hover::after {
  transform: translateY(-#{$image-view-picture-nav-size / 6}) scale(1.1);
}
.image-view__picture-nav:focus-visible::after {
  box-shadow: $input-focus-box-shadow;
}

.image-view__picture-nav-prev::after {
  right: $image-view-picture-nav-gap-y;
  background-image: escape-svg(
    url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="#{$image-view-picture-nav-color}" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm11.5 5.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>')
  );
}
.image-view__picture-nav-next::after {
  left: $image-view-picture-nav-gap-y;
  background-image: escape-svg(
    url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="#{$image-view-picture-nav-color}" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm4.5 5.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/></svg>')
  );
}

.image-view__picture-nav-prev {
  left: 0;
}
.image-view__picture-nav-next {
  right: 0;
}

.image-view__picture-nav:hover,
.image-view__picture-nav:focus-visible {
  outline: none;
}

.image-view__details {
  width: $image-view-sidebar-width;
  font-size: $font-size-lg;
}
.image-view__details-head,
.image-view__details-content {
  padding: $image-view-toolbar-y-pad $main-x-pad;
}
.image-view__details-head {
  text-align: left;
  border-bottom: 1px solid $contrast2;
}
.image-view__details-toggle {
  margin-left: -$btn-close-padding-x;
  position: relative;
  top: -.25em;
}

/*
  Custom scrollbar
*/

$scrollbar-size: 16px;
$scrollbar-track-color: transparent;
$scrollbar-thumb-color: #666;

html,
.scrollbar {
  scrollbar-color: $scrollbar-thumb-color $scrollbar-track-color;
}
html::-webkit-scrollbar,
.scrollbar::-webkit-scrollbar {
  width: $scrollbar-size;
  height: $scrollbar-size;
}
html::-webkit-scrollbar-thumb,
.scrollbar::-webkit-scrollbar-thumb {
  background: $scrollbar-thumb-color;
  border-radius: $scrollbar-size;
  border: 4px solid transparent;
  background-clip: content-box;
}
html::-webkit-scrollbar-track,
.scrollbar::-webkit-scrollbar-track {
  background: $scrollbar-track-color;
}

/*
  Definition list
*/

.dlist_0 > dt,
.dlist_0 > dd {
  display: inline;
}
.dlist_0 > dd:after {
  content: '\A';
  white-space: pre;
  display: block;
  line-height: 5px;
  height: 5px;
}


/*
  Tags list
*/

.tags__tag {
  margin-bottom: .5em;
}

/*
  Tag
*/
$tag-delete-gap-x: .25em;

.tag,
.tag__delete {
  border-radius: 1.6em;
}
.tag {
  position: relative;
  padding-right: calc(#{$btn-close-width} + #{$input-btn-focus-width} + #{$btn-close-padding-x * 2} + #{$tag-delete-gap-x});
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  text-align: left;
}
.tag__delete {
  position: absolute;
  right: $tag-delete-gap-x;
  top: 50%;
  transform: translateY(-50%);
  will-change: filter;
  filter: invert(100%);
}
.tag__delete:hover,
.tag__delete:focus-visible {
  filter: invert(0);
}
// make selector more specific to overwrite generic focusable elements styles (see `css/customised-bootstrap.scss`)
.tag .tag__delete.btn-close {
  @include transition($btn-transition, filter .15s);
}

/*
  Fullscreen upload target
*/
$drop-target-transition-duration: .2s;

.drop-target {
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 999;
  background-color: transparentize($dark, .05);
  opacity: 0;
  visibility: hidden;
  will-change: opacity;
}
.drop-target.is-active {
  visibility: visible;
  opacity: 1;
  transition: visibility $drop-target-transition-duration, opacity $drop-target-transition-duration;
}
.drop-target__message {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 1200px;
  max-width: 100%;
  padding: 1em;
  font-size: 3rem;
  text-align: center;
}

/*
  Drop manager
*/
.drop-manager:not(.is-single-image) .drop-manager__note,
.drop-manager__note_upload,
.drop-manager.is-upload-preferred .drop-manager__note_search {
  display: none;
}
.drop-manager.is-upload-preferred .drop-manager__note_upload {
  display: block;
}

.drop-manager__note {
  font-size: .65em;
}
